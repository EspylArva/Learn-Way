---
tags: [data_handling]
---
# File Upload Vulnerability
## Context
In application where users are allowed to upload files, having no restriction can cause problems and be exploited
## Danger
Attackers can overcharge the server, resulting in a [[Denial of Service|DoS]] for other users
## Example
### Lack of extension check
An application allows its users to upload files, without checking extensions, and open them in the application. An attacker uploads a shell file and can run the commands on the web server shell
### Lack of content check
An application allows users to send files to other users. An attacker sends a [[Phishing|phishing]] page to retrieve its victims' credentials. The [[Phishing|phishing]] page retrieves the credentials and redirects the victim to the real website, completing the attack with limited 
## Counter Measures
- Apply allow-list validation from file names and extensions
- Apply regex validation on file names to forbid special characters, and limit length to a fixed amount of characters
- Save files with the detected extensions, not the original extension. This is part of [[Trust no Input]], as users can change the file extension freely
- Scan uploaded files for malicious content
- Use MIME type detection
- Store uploaded files in a private, separate directory without execution privileges
- Enforce minimum and maximum size limit
- Remove [[EXIF]] data
- Store files with randomly generated file name, and keep a table mapping to the original name if necessary